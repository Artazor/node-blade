/** Blade Run-time helper functions
	(c) Copyright 2012. Blake Miner. All rights reserved.	
	https://github.com/bminer/node-blade
	http://www.blakeminer.com/
	
	See the full license here:
		https://raw.github.com/bminer/node-blade/master/LICENSE.txt
*/(function(){function n(e,t){e.filename=t.filename,e.line=t.line,e.col=t.col}function r(e,t,n){var r=e.buf.splice(n,e.buf.length-n);Array.prototype.unshift.apply(e.buf,r);for(var i in t.blocks)t.blocks[i].parent==e&&t.blocks[i].pos>=n&&(t.blocks[i].pos-=n)}function i(e,t){var n=e+" ";for(var r=0;r<t-n.length+1;r++)n=" "+n;return n}var e=typeof exports=="object"?exports:{},t={};if(e.client=typeof window!="undefined")window.blade={runtime:e,cachedViews:t,cb:{},rootURL:"/views"};e.escape=function(e){return e==null?"":(new String(e)).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.attrs=function(t,n){for(var r in t){var i=t[r];if(i.v==null){if(i.a==null)continue;i.v=i.a,delete i.a}r=="class"&&(i.v instanceof Array&&(i.v=i.v.join(" ")),i.a&&(i.v=(i.v.length>0?i.v+" ":"")+i.a)),i.e?n.push(" "+r+'="'+e.escape(i.v)+'"'):n.push(" "+r+'="'+i.v+'"')}},e.loadTemplate=function(n,r,i,s){typeof i=="function"&&(s=i,typeof r=="object"?(i=r,r=n,n=""):i=null),typeof r=="function"&&(s=r,r=n,i=null,n="");if(e.client){r=e.resolve(r);if(t[r])return s(null,t[r]),!0;var o=window.blade;if(o.cb[r])throw new Error("Template is already loading. Be patient.");var u=document.createElement("script");u.type="application/javascript",u.async=!0,u.src=o.rootURL+"/"+r;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(u,a);var f=setTimeout(function(){delete o.cb[r],u.parentNode.removeChild(u),s(new Error("Timeout Error: Blade Template ["+r+"] could not be loaded."))},15e3);return o.cb[r]=function(a,l){clearTimeout(f),delete o.cb[r],u.parentNode.removeChild(u);if(a.length>0){var c=0;for(var h=0;h<a.length;h++)e.loadTemplate(n,a[h],i,function(e,n){if(e)throw e;++c==a.length&&s(null,t[r])})}else s(null,t[r])},!1}return i.synchronous=!0,require("./blade").compileFile(n+"/"+r,i,function(e,t){if(e)return s(e);s(null,t.template)}),!0},e.resolve=function(t){if(e.client){var n=document.createElement("div");return n.innerHTML='<a href="'+e.escape("./"+t)+'"></a>',n=n.firstChild.href,n=n.substr(window.location.href.length).replace(/\/\//g,"/"),n.charAt(0)=="/"&&(n=n.substr(1)),n}},e.include=function(t,n){var r=n.inc,i=n.base,s=n.rel,o=n.filename,u=n.line,a=n.col,f=n.source,l=n.locals;n.inc=!0;var c=t.split("/");c=c[c.length-1].indexOf("."),c<0&&(t+=".blade");if(arguments.length>2){n.locals={};for(var h=2;h<arguments.length;h+=2)n.locals[arguments[h]]=arguments[h+1]}var p=e.loadTemplate(n.base,n.rel+"/"+t,e.compileOptions,function(e,t){if(e)throw e;t(n.locals,function(e,t){if(e)throw e;n.inc=r,n.base=i,n.rel=s,n.filename=o,n.line=u,n.col=a,n.source=f,n.locals=l},n)});if(!p)throw new Error("Included file ["+n.rel+"/"+t+"] could not be loaded synchronously!")},e.capture=function(e,t){var n=t.pos;for(var r in e.blocks)e.blocks[r].pos>=n&&delete e.blocks[r];return e.splice(n,e.length-n).join("")},e.chunk=function(t,n,r){r.chunk[t]=function(){return e.capture(r,n.apply({pos:r.length},arguments))}},e.blockDef=function(e,t,r){var i=t.blocks[e]={parent:t.block||null,buf:[],pos:t.length,numChildren:0},s=["r","blocks","func","locals","cb","base","rel"];for(var o in s)i.buf[s[o]]=t[s[o]];i.buf.block=i,i.parent&&i.parent.numChildren++,t.push("");if(r.length>1)i.paramBlock=r;else try{r(i.buf)}catch(u){throw n(t,i.buf),u}},e.blockRender=function(e,t,i){var s=i.blocks[t];if(s==null)throw new Error("Block '"+t+"' is undefined.");if(s.paramBlock==null)throw new Error("Block '"+t+"' is a regular, non-parameterized block, which cannot be rendered.");var o=[s.buf];for(var u=3;u<arguments.length;u++)o[u-2]=arguments[u];e=="r"&&(s.buf.length=0);var a=s.buf.length;try{s.paramBlock.apply(this,o)}catch(f){throw n(i,s.buf),f}e=="p"&&r(s,i,a)},e.blockMod=function(e,t,i,s){var o=i.blocks[t];if(o==null)throw new Error("Block '"+t+"' is undefined.");e=="r"&&(delete o.paramBlock,o.buf.length=0);var u=o.buf.length;if(s.length>1)o.paramBlock=s;else try{s(o.buf)}catch(a){throw n(i,o.buf),a}e=="p"&&r(o,i,u)},e.done=function(e){var t=!1;while(!t){t=!0;for(var n in e.blocks){var r=e.blocks[n];!r.done&&r.numChildren==0&&(t=!1,r.parent==null?e[r.pos]=r.buf.join(""):(r.parent.buf[r.pos]=r.buf.join(""),r.parent.numChildren--),r.done=!0)}}},e.rethrow=function(e,t){t==null&&(t=e);if(e.lastFilename==t.filename&&e.lastFilename!=null)return e;t.column=t.column||t.col;var n=e.message+"\n    at "+(t.filename==null?"<anonymous>":t.filename)+(t.line==null?"":":"+t.line+(t.column==null?"":":"+t.column));if(t.source!=null){const r=3;var s=t.source.split("\n"),o=Math.max(t.line-r,0),u=Math.min(t.line+r,s.length),a=(new String(u)).length;s=s.slice(o,u),n+="\n\n";for(var f=0;f<s.length;f++)n+=i(f+o+1,a)+(f+o+1==t.line?">	":"|	")+s[f]+"\n"}return e.message=n,e.lastFilename=t.filename,e.filename==null&&e.line==null&&(e.filename=t.filename,e.line=t.line,e.column=t.column),e}})();