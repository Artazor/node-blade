/** Blade Run-time helper functions
	(c) Copyright 2012. Blake Miner. All rights reserved.	
	https://github.com/bminer/node-blade
	http://www.blakeminer.com/
	
	See the full license here:
		https://raw.github.com/bminer/node-blade/master/LICENSE.txt
*/(function(){function n(e,t,n){var r=e.buf.splice(n,e.buf.length-n);Array.prototype.unshift.apply(e.buf,r);for(var i in t.blocks)t.blocks[i].parent==e&&t.blocks[i].pos>=n&&(t.blocks[i].pos-=n)}function r(e,t){var n=e+" ";for(var r=0;r<t-n.length+1;r++)n=" "+n;return n}var e=typeof exports=="object"?exports:{},t={};if(e.client=typeof window!="undefined")window.blade={runtime:e,cachedViews:t,cb:{},rootURL:"/views"};e.escape=function(e){return e==null?"":(new String(e)).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.attrs=function(t,n){for(var r in t){if(t[r].val==null){if(t[r].append==null)continue;t[r].val=t[r].append,delete t[r].append}r=="class"&&(t[r].val instanceof Array&&(t[r].val=t[r].val.join(" ")),t[r].append&&(t[r].val=(t[r].val.length>0?t[r].val+" ":"")+t[r].append)),t[r].escape?n.push(" "+r+'="'+e.escape(t[r].val)+'"'):n.push(" "+r+'="'+t[r].val+'"')}},e.loadTemplate=function(n,r,i,s){typeof i=="function"&&(s=i,typeof r=="object"?(i=r,r=n,n=""):i=null),typeof r=="function"&&(s=r,r=n,i=null,n="");if(e.client){r=e.resolve(r);if(t[r])return s(null,t[r]);var o=window.blade;if(o.cb[r])throw new Error("Template is already loading. Be patient.");var u=document.createElement("script");u.type="application/javascript",u.async=!0,u.src=o.rootURL+"/"+r;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(u,a);var f=setTimeout(function(){delete o.cb[r],u.parentNode.removeChild(u),s(new Error("Timeout Error: Blade Template ["+r+"] could not be loaded."))},15e3);o.cb[r]=function(e){clearTimeout(f),delete o.cb[r],u.parentNode.removeChild(u),s(null,e[r])}}else{var o=require("./blade");o.compileFile(n+"/"+r,i,function(e,t){if(e)return s(e);s(null,t.template)})}},e.resolve=function(t){if(e.client){var n=document.createElement("div");return n.innerHTML='<a href="'+e.escape("./"+t)+'"></a>',n=n.firstChild.href,n=n.substr(window.location.href.length).replace(/\/\//g,"/"),n.charAt(0)=="/"&&(n=n.substr(1)),n}},e.include=function(t,n,r){function c(e,t){i||(n.inc=!1),n.filename=s,n.base=o,n.rel=u,n.line=a,n.col=f,n.source=l,r(e)}var i=n.inc,s=n.filename,o=n.base,u=n.rel,a=n.line,f=n.col,l=n.source;n.inc=!0;var h=t.split("/");h=h[h.length-1].indexOf("."),h<0&&(t+=".blade"),e.loadTemplate(n.base,n.rel+"/"+t,e.compileOptions,function(e,t){if(e)return r(e);t(n.locals,c,n)})},e.capture=function(e,t){var n=t.pos;for(var r in e.blocks)e.blocks[r].pos>=n&&delete e.blocks[r];return e.splice(n,e.length-n).join("")},e.chunk=function(t,n,r){r.chunk[t]=function(){return e.capture(r,n.apply({pos:r.length},arguments))}},e.blockDef=function(e,t,n){var r=t.blocks[e]={parent:t.block||null,buf:[],pos:t.length,numChildren:0},i=["r","blocks","func","locals","cb"];for(var s in i)r.buf[i[s]]=t[i[s]];r.buf.block=r,r.parent&&r.parent.numChildren++,t.push("");if(n.length>1)r.paramBlock=n;else try{n(r.buf)}catch(o){throw t.line=r.buf.line,t.col=r.buf.col,o}return r},e.blockRender=function(e,t,r){var i=r.blocks[t];if(i==null)throw new Error("Block '"+t+"' is undefined.");if(i.paramBlock==null)throw new Error("Block '"+t+"' is a regular, non-parameterized block, which cannot be rendered.");var s=[i.buf];for(var o=3;o<arguments.length;o++)s[o-2]=arguments[o];e=="r"&&(i.buf.length=0);var u=i.buf.length;try{i.paramBlock.apply(this,s)}catch(a){throw r.line=i.buf.line,r.col=i.buf.col,a}e=="p"&&n(i,r,u)},e.blockMod=function(e,t,r,i){var s=r.blocks[t];if(s==null)throw new Error("Block '"+t+"' is undefined.");e=="r"&&(delete s.paramBlock,s.buf.length=0);var o=s.buf.length;if(i.length>1)s.paramBlock=i;else try{i(s.buf)}catch(u){throw r.line=s.buf.line,r.col=s.buf.col,u}e=="p"&&n(s,r,o)},e.done=function(e){var t=!1;while(!t){t=!0;for(var n in e.blocks){var r=e.blocks[n];!r.done&&r.numChildren==0&&(t=!1,r.parent==null?e[r.pos]=r.buf.join(""):(r.parent.buf[r.pos]=r.buf.join(""),r.parent.numChildren--),r.done=!0)}}},e.rethrow=function(e,t){t==null&&(t=e);if(e.lastFilename==t.filename&&e.lastFilename!=null)return e;t.column=t.column||t.col;var n=e.message+"\n    at "+(t.filename==null?"<anonymous>":t.filename)+(t.line==null?"":":"+t.line+(t.column==null?"":":"+t.column));if(t.source!=null){const i=3;var s=t.source.split("\n"),o=Math.max(t.line-i,0),u=Math.min(t.line+i,s.length),a=(new String(u)).length;s=s.slice(o,u),n+="\n\n";for(var f=0;f<s.length;f++)n+=r(f+o+1,a)+(f+o+1==t.line?">	":"|	")+s[f]+"\n"}return e.message=n,e.lastFilename=t.filename,e.filename==null&&e.line==null&&(e.filename=t.filename,e.line=t.line,e.column=t.column),e}})();