/** Blade Run-time helper functions
	(c) Copyright 2012. Blake Miner. All rights reserved.	
	https://github.com/bminer/node-blade
	http://www.blakeminer.com/
	
	See the full license here:
		https://raw.github.com/bminer/node-blade/master/LICENSE.txt
*/(function(){function c(a,b){var c=a+" ";for(var d=0;d<b-c.length+1;d++)c=" "+c;return c}var a=typeof exports=="object"?exports:{},b={};if(a.client=typeof window!="undefined")window.blade={runtime:a,cachedViews:b,cb:{}};a.escape=function(a){return(new String(a)).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},a.attrs=function(b,c){for(var d in b){if(b[d].val==null){if(b[d].append==null)continue;b[d].val=b[d].append,delete b[d].append}d=="class"&&(b[d].val instanceof Array&&(b[d].val=b[d].val.join(" ")),b[d].append&&(b[d].val=(b[d].val.length>0?b[d].val+" ":"")+b[d].append)),b[d].escape?c.push(" "+d+'="'+a.escape(b[d].val)+'"'):c.push(" "+d+'="'+b[d].val+'"')}},a.loadTemplate=function(c,d,e,f){typeof e=="function"&&(f=e,typeof d=="object"?(e=d,d=c,c=""):e=null),typeof d=="function"&&(f=d,d=c,e=null,c="");if(a.client){b[d]&&f(null,b[d]);var g=window.blade;if(g.cb[d])throw new Error("Template is already loading. Be patient.");var h=document.createElement("script");h.type="application/javascript",h.async=!0,h.src="/views/"+d;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(h,i);var j=setTimeout(function(){delete g.cb[d],h.parentNode.removeChild(h),f(new Error("Timeout Error: Blade Template ["+d+"] could not be loaded."))},15e3);g.cb[d]=function(a){clearTimeout(j),delete g.cb[d],h.parentNode.removeChild(h),f(null,a[d])}}else{b[c+"/"+d]&&f(null,b[c+"/"+d]);var g=require("./blade");g.compileFile(c+"/"+d,e,function(a,b){if(a)return f(a);f(null,b.template)})}},a.include=function(b,c,d,e){function k(a,b){f||(d.inc=!1),d.filename=g,d.line=h,d.col=i,d.source=j,e(a)}var f=d.inc,g=d.filename,h=d.line,i=d.col,j=d.source;d.inc=!0,a.loadTemplate(b,c,a.compileOptions,function(a,b){if(a)return e(a);b(d.locals,k,d)})},a.capture=function(a,b){for(var c in a.blocks)a.blocks[c].pos>=b&&delete a.blocks[c];return a.splice(b,a.length-b).join("")},a.blockDef=function(a,b,c){var d=b.blocks[a]={parent:b.block||null,buf:[],pos:b.length,numChildren:0},e=["r","blocks","func","locals","cb"];for(var f in e)d.buf[e[f]]=b[e[f]];return d.buf.block=d,d.parent&&d.parent.numChildren++,b.push(""),c.length>1?d.paramBlock=c:c(d.buf),d},a.blockRender=function(a,b){var c=b.blocks[a];if(c==null)throw new Error("Block '"+a+"' is undefined.");if(c.paramBlock==null)throw new Error("Block '"+a+"' is a regular, non-parameterized block, which cannot be rendered.");var d=[c.buf];for(var e=2;e<arguments.length;e++)d[e-1]=arguments[e];c.paramBlock.apply(this,d)},a.blockMod=function(a,b,c,d){var e=c.blocks[b];if(e==null)throw new Error("Block '"+b+"' is undefined.");a=="r"&&(delete e.paramBlock,e.buf.splice(0,c.length));var f=e.buf.length;d(e.buf);if(a=="p"){var g=e.buf.splice(f,e.buf.length-f);Array.prototype.unshift.apply(e.buf,g);for(var h in c.blocks)c.blocks[h].parent==e&&c.blocks[h].pos>=f&&(c.blocks[h].pos-=f)}},a.done=function(a){var b=!1;while(!b){b=!0;for(var c in a.blocks){var d=a.blocks[c];!d.done&&d.numChildren==0&&(b=!1,d.parent==null?a[d.pos]=d.buf.join(""):(d.parent.buf[d.pos]=d.buf.join(""),d.parent.numChildren--),d.done=!0)}}},a.rethrow=function(a,b){b==undefined&&(b=a),b.column=b.column||b.col;var d=a.message+"\n    at "+(b.filename==null?"<anonymous>":b.filename)+(b.line==null?"":":"+b.line)+(b.column==null?"":":"+b.column);if(b.source!=null){const e=3;var f=b.source.split("\n"),g=Math.max(b.line-e,0),h=Math.min(b.line+e,f.length),i=(new String(h)).length;f=f.slice(g,h),d+="\n\n";for(var j=0;j<f.length;j++)d+=c(j+g+1,i)+(j+g+1==b.line?">	":"|	")+f[j]+"\n"}return a.message=d,a.filename=b.filename,a.line=b.line,a.column=b.column,a}})();